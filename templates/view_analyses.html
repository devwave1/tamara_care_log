<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Analyses</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 30px; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; }
    th { background-color: #f5f5f5; }
    .form-section { margin-bottom: 20px; }
    label { font-weight: bold; margin-right: 10px; }
    input, select { padding: 5px; margin-right: 10px; }
  .analysis-text p { margin: 0 0 .5rem; }
  .analysis-text ul, .analysis-text ol { margin: 0 0 .75rem 1.25rem; }
  .analysis-text h2, .analysis-text h3, .analysis-text h4 { margin: .75rem 0 .25rem; }
  .analysis-text table { width: 100%; border-collapse: collapse; }
  .analysis-text th, .analysis-text td { border: 1px solid #ddd; padding: 6px; }
  .analysis-text a { text-decoration: underline; }
  .analysis-text { word-break: break-word; }
  </style>
</head>
<body>
  {% include 'header.html' %}
  <div class="container">
    <h1>Analysis Entries</h1>
    <form method="GET" action="{{ url_for('view_analyses') }}" class="form-section">
      <label for="carer">Carer:</label>
      <select name="carer_name" id="carer">
        <option value="">-- All Carers --</option>
        {% for carer in carer_names %}
          <option value="{{ carer }}" {% if selected_carer == carer %}selected{% endif %}>{{ carer }}</option>
        {% endfor %}
      </select>
      <button type="submit">Filter</button>
      <a href="{{ url_for('view_analyses') }}">Clear Filters</a>
    </form>
    <table>
<thead>
  <tr>
    <th>Date & Time</th>
    <th>Carer</th>
    <th>Analysis Text</th>
    <th style="width:140px;">Actions</th>
  </tr>
</thead>
<tbody>
{% for analysis in analyses %}
  <tr>
    <td>{{ analysis.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
    <td>{{ analysis.carer_name }}</td>
    <td class="analysis-text">{{ analysis.analysis_text | safe }}</td>
    <td>
      <a class="btn btn-sm btn-primary" href="{{ url_for('edit_analysis', analysis_id=analysis.id) }}">Edit</a>
      <form method="POST" action="{{ url_for('delete_analysis', analysis_id=analysis.id) }}"
            style="display:inline"
            onsubmit="return confirm('Delete this analysis?');">
        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
      </form>
    </td>
  </tr>
{% else %}
  <tr><td colspan="4">No entries found.</td></tr>
{% endfor %}
</tbody>

    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
